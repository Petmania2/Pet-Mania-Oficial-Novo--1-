<!DOCTYPE html>
<html>
<head>
    <title>Teste Mercado Pago - Pet Mania</title>
    <script src="https://sdk.mercadopago.com/js/v2"></script>
</head>
<body>
    <h1>Teste de Pagamento - Pet Mania</h1>
    
    <section>
        <h3>Produtos Disponíveis:</h3>
        <button onclick="comprarProduto('1')">Ração Premium - R$ 89,90</button>
        <button onclick="comprarProduto('2')">Coleira Antipulgas - R$ 45,50</button>
        <button onclick="comprarProduto('3')">Brinquedo Interativo - R$ 29,90</button>
    </section>
    
    <section id="wallet_container"></section>
    
    <script>
        const mp = new MercadoPago('<%= process.env.MP_PUBLIC_KEY %>');
        
        function comprarProduto(produtoId) {
            fetch('/comprar-produto', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    produtoId: produtoId,
                    quantidade: 1
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.preferenceId) {
                    document.getElementById('wallet_container').innerHTML = '';
                    mp.bricks().create("wallet", "wallet_container", {
                        initialization: {
                            preferenceId: data.preferenceId,
                        }
                    });
                }
            })
            .catch(error => console.error('Erro:', error));
        }
    </script>
</body>
</html>